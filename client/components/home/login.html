import riot from 'riot'
import moment from 'momentjs'
import EVT from '../../state-manager/event_constants' 

<login>
    <link href="http://materializecss.com/css/prism.css" rel="stylesheet">
    <link href="http://materializecss.com/css/ghpages-materialize.css" type="text/css" rel="stylesheet" media="screen,projection">
    <link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--  Parallax Section  -->
  <div class="section" style="padding:5%;width: 30%;vertical-align: middle;">
    <section id="messageSection">Auth status is {global.state.authStatus}</section>
    <input type="text" id="userid" placeholder="User Id" value='{global.state.userId}'>
    <input id="password" type="password" placeholder="Password" value='{global.state.userPassword}''>  
    <button id="submitLogin">Login</button>
    <button id="resetLogin">Reset</button>
  </div>
  <script>
    let self = this;
    self.global = self.global || {}
    self.global.state = {authStatus:false,me:'saurshaz'}

    // TODO :: TAKE THIS TO A CENTRAL PLACE (CONFIG THIS IS)
    let events_array = {
                        login:[
                                {
                                  selector:'button#submitLogin',
                                  event:'click',
                                  signal:'',
                                  handler:'user.handleLogin',
                                  state:self.global.state,
                                  passedData:{userId:self.global.state.userId, userPassword:self.global.state.userPassword}
                                },
                                {
                                  selector:'button#resetLogin',
                                  event:'click',
                                  signal:'',
                                  handler:'user.handleResetLogin',
                                  state:self.global.state
                                }
                              ]
                      }   

    // TODO :: HANDLER OBJECT
    self.handlers = {}
    self.handlers.user = {}
    self.handlers.user.handleLogin = function (data,event,cb) {
      console.log(this)
      if(data.userId === 'saurshaz' && data.userPassword === 'password'){
        this.userId === '' 
        this.userPassword === ''
        this.loggedIn = true
        this.me = data.userId
      }


    }

    self.handlers.user.resetLogin = function (data,event,cb) {
      console.log(this)
      this.loggedIn = false
      this.userId === '' 
      this.userPassword === ''
      this.loggedIn = false
    }


    // setTimeout(function() {
    //   // riot.control.trigger(EVT.INIT_CHAT_CONTAINER, {'a':'b'});
    // }, 2500);
    self.on('mount', function() {
      // riot.mount('*')
      for(let idx in events_array['login']){
        let event_json = events_array['login'][idx]
        let handler = event_json.handler.split('.')[1]
        let handlerObj = event_json.handler.split('.')[0]
        // debugger;
        self.update()
        self.root.querySelector(event_json.selector).addEventListener(event_json.event, self.handlers[handlerObj][handler].bind(self.global.state,event_json.passedData))
      }
      self.update()
    })
  </script>
</login>
